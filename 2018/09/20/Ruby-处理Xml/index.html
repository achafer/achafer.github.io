<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Ruby 处理Xml · 远山淡影</title><meta name="description" content="Ruby 处理Xml - 阿扯"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/solarized-light.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.ache.fun/atom.xml" title="远山淡影"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/lion.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/links/" target="_self" class="nav-list-link">LINKS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Ruby 处理Xml</h1><div class="tags"><a href="/tags/Ruby/" class="tag-title">#Ruby</a></div><div class="post-info">Sep 20, 2018</div><div class="post-content"><p>Ruby处理Xml主要使用内置的库<a href="https://ruby-doc.org/stdlib-2.1.2/libdoc/rexml/rdoc/REXML/Document.html" target="_blank" rel="noopener"><code>REXML</code></a>，它提供了两种解析方式<code>tree parsing</code>和<code>stream parsing</code></p>
<h6 id="实例XML代码，games-xml"><a href="#实例XML代码，games-xml" class="headerlink" title="实例XML代码，games.xml"></a>实例XML代码，games.xml</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">game</span> <span class="attr">title</span>=<span class="string">"The Legend of Zelda: Breath of the Wild"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">company</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nintendo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">location</span>&gt;</span>Japanese<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">platform</span>&gt;</span>NS<span class="tag">&lt;/<span class="name">platform</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">platform</span>&gt;</span>WiiU<span class="tag">&lt;/<span class="name">platform</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pubdate</span>&gt;</span>2017<span class="tag">&lt;/<span class="name">pubdate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">game</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">game</span> <span class="attr">title</span>=<span class="string">"PUBG"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">company</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>PUBG Corporation<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">location</span>&gt;</span>Korea<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">company</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">platform</span>&gt;</span>PC<span class="tag">&lt;/<span class="name">platform</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">platform</span>&gt;</span>Xbox one<span class="tag">&lt;/<span class="name">platform</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pubdate</span>&gt;</span>2017<span class="tag">&lt;/<span class="name">pubdate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">game</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="在Ruby中使用tree-parsing-API打开文件"><a href="#在Ruby中使用tree-parsing-API打开文件" class="headerlink" title="在Ruby中使用tree parsing API打开文件"></a>在Ruby中使用tree parsing API打开文件</h5><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'rexml/document'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> REXML</span><br><span class="line"></span><br><span class="line">file = File.new(<span class="string">"games.xml"</span>)</span><br><span class="line"></span><br><span class="line">doc = Document.new(file)</span><br><span class="line"></span><br><span class="line">puts doc</span><br></pre></td></tr></table></figure>
<p><code>Document.new</code>方法传入的参数必须是 <code>Document</code>，<code>IO</code>, 或字符串，这里的<code>Document</code>官方文档指的是<code>REXML</code>的<code>Document</code>但经测试生成的新的doc为空，不知是否为Ruby的<code>Here Document</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">rb(main):001:0&gt; require 'rexml/document'</span><br><span class="line">=&gt; true</span><br><span class="line">irb(main):002:0&gt; include REXML</span><br><span class="line">=&gt; Object</span><br><span class="line">irb(main):003:0&gt; doc = Document.new(File.new("games.xml"))</span><br><span class="line">=&gt; &lt;UNDEFINED&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):004:0&gt; puts doc</span><br><span class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span><br><span class="line">&lt;collection id='test'&gt;</span><br><span class="line">    &lt;game title='The Legend of Zelda: Breath of the Wild'&gt;</span><br><span class="line">        &lt;company&gt;</span><br><span class="line">            &lt;name&gt;Nintendo&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Japanese&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">        &lt;platform&gt;NS&lt;/platform&gt;</span><br><span class="line">        &lt;platform&gt;WiiU&lt;/platform&gt;</span><br><span class="line">        &lt;pubdate&gt;2017&lt;/pubdate&gt;</span><br><span class="line">    &lt;/game&gt;</span><br><span class="line">    &lt;game title='PUBG'&gt;</span><br><span class="line">        &lt;company&gt;</span><br><span class="line">            &lt;name&gt;PUBG Corporation&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Korea&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">        &lt;platform&gt;PC&lt;/platform&gt;</span><br><span class="line">        &lt;platform&gt;Xbox one&lt;/platform&gt;</span><br><span class="line">        &lt;pubdate&gt;2017&lt;/pubdate&gt;</span><br><span class="line">    &lt;/game&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line">=&gt; nil</span><br><span class="line"></span><br><span class="line">irb(main):005:0&gt; doc2 = Document.new(doc)</span><br><span class="line">=&gt; &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):006:0&gt; puts doc2</span><br><span class="line">=&gt; nil</span><br></pre></td></tr></table></figure>
<h5 id="访问元素和属性"><a href="#访问元素和属性" class="headerlink" title="访问元素和属性"></a>访问元素和属性</h5><p>方便调试，使用<code>irb</code>工具来访问元素</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> irb</span><br><span class="line"><span class="meta">&gt;</span>&gt; require 'rexml/document'</span><br><span class="line">=&gt; true</span><br><span class="line"><span class="meta">&gt;</span>&gt; include REXML</span><br><span class="line">=&gt; Object</span><br><span class="line"><span class="meta">&gt;</span>&gt; doc = Document.new(File.new("games.xml"))</span><br><span class="line">=&gt; &lt;UNDEFINED&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; root = doc.root</span><br><span class="line">=&gt; &lt;collection id='test'&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; root.class</span><br><span class="line">=&gt; REXML::Element</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; root.attributes['id']</span><br><span class="line">=&gt; "test"</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; puts root.elements[1].elements["company"]</span><br><span class="line">&lt;company&gt;</span><br><span class="line">            &lt;name&gt;Nintendo&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Japanese&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">=&gt; nil</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; puts root.elements["game[1]/company"]</span><br><span class="line">&lt;company&gt;</span><br><span class="line">            &lt;name&gt;Nintendo&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Japanese&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">=&gt; nil</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; puts root.elements["game[@title='PUBG']"]</span><br><span class="line">&lt;game title='PUBG'&gt;</span><br><span class="line">        &lt;company&gt;</span><br><span class="line">            &lt;name&gt;PUBG Corporation&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Korea&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">        &lt;platform&gt;PC&lt;/platform&gt;</span><br><span class="line">        &lt;platform&gt;Xbox one&lt;/platform&gt;</span><br><span class="line">        &lt;pubdate&gt;2017&lt;/pubdate&gt;</span><br><span class="line">    &lt;/game&gt;</span><br><span class="line">=&gt; nil</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span>&gt; root.each_element('//company') &#123;|company| puts company&#125;</span><br><span class="line">&lt;company&gt;</span><br><span class="line">            &lt;name&gt;Nintendo&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Japanese&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">&lt;company&gt;</span><br><span class="line">            &lt;name&gt;PUBG Corporation&lt;/name&gt;</span><br><span class="line">            &lt;location&gt;Korea&lt;/location&gt;</span><br><span class="line">        &lt;/company&gt;</span><br><span class="line">=&gt; [&lt;company&gt; ... &lt;/&gt;, &lt;company&gt; ... &lt;/&gt;]</span><br></pre></td></tr></table></figure>
<p>首先，使用Document.new()，生成一个<a href="https://ruby-doc.org/stdlib-2.1.2/libdoc/rexml/rdoc/REXML/Document.html" target="_blank" rel="noopener">Document</a>对象，Document.root 返回文档的根元素（<a href="https://ruby-doc.org/stdlib-2.1.2/libdoc/rexml/rdoc/REXML/Element.html" target="_blank" rel="noopener">Element对象</a>），如果此文档没有子元素，则返回nil。<code>Element</code>对象提供了<code>attribute</code>，<code>element</code>的增加、删除和检测、<code>text</code>的添加、子<code>element</code>的遍历等等，详见其<a href="https://ruby-doc.org/stdlib-2.1.2/libdoc/rexml/rdoc/REXML/Element.html" target="_blank" rel="noopener">API文档</a>。Element.elements 是<a href="https://ruby-doc.org/stdlib-2.1.2/libdoc/rexml/rdoc/REXML/Elements.html" target="_blank" rel="noopener">Elements对象</a>，<code>Elements</code>是为<code>Element</code>提供子元素过滤和Xpath搜索支持，主要使用的是<code>[]</code>方法，<code>[]</code>的参数可以是子元素的索引和<a href="https://www.w3.org/TR/1999/REC-xpath-19991116/" target="_blank" rel="noopener"><code>XPath</code></a>表达式，子元素的索引和<code>XPath</code>的一样是从<strong>1</strong>开始。</p>
<h5 id="创建和插入元素属性"><a href="#创建和插入元素属性" class="headerlink" title="创建和插入元素属性"></a>创建和插入元素属性</h5><p>创建一个空白文档，并添加元素和属性</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">irb(main):001:0&gt; require 'rexml/document'</span><br><span class="line">=&gt; true</span><br><span class="line">irb(main):002:0&gt; include REXML</span><br><span class="line">=&gt; Object</span><br><span class="line">irb(main):003:0&gt; doc2 = Document.new</span><br><span class="line">=&gt; &lt;UNDEFINED/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):004:0&gt; doc2.class</span><br><span class="line">=&gt; REXML::Document</span><br><span class="line"></span><br><span class="line">irb(main):005:0&gt; doc2.add_element("collection", &#123;"id"=&gt; "test"&#125;)</span><br><span class="line">=&gt; &lt;collection id='test'/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):006:0&gt; doc2.root.add_element("game")</span><br><span class="line">=&gt; &lt;game/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):007:0&gt; game = doc2.root.elements[1]</span><br><span class="line">=&gt; &lt;game/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):008:0&gt; company = Element.new("company")</span><br><span class="line">=&gt; &lt;company/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):009:0&gt; company.add_element("name")</span><br><span class="line">=&gt; &lt;name/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):010:0&gt; company.elements["name"].text = "Riot Games"</span><br><span class="line">=&gt; "Riot Games"</span><br><span class="line"></span><br><span class="line">irb(main):011:0&gt; company.add_element("location")</span><br><span class="line">=&gt; &lt;location/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):012:0&gt; company.elements["location"].text = "America"</span><br><span class="line">=&gt; "America"</span><br><span class="line"></span><br><span class="line">irb(main):013:0&gt; game.elements &lt;&lt; company</span><br><span class="line">=&gt; &lt;company&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):014:0&gt; platform = Element.new("platform")</span><br><span class="line">=&gt; &lt;platform/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):015:0&gt; platform.text = "Microsoft Windows"</span><br><span class="line">=&gt; "Microsoft Windows"</span><br><span class="line"></span><br><span class="line">irb(main):016:0&gt; game.elements &lt;&lt; platform</span><br><span class="line">=&gt; &lt;platform&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):018:0&gt; game.elements &lt;&lt; Element.new("pubdate")</span><br><span class="line">=&gt; &lt;pubdate/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):020:0&gt; game.elements["pubdate"].text = "2011"</span><br><span class="line">=&gt; "2011"</span><br><span class="line"></span><br><span class="line">irb(main):021:0&gt; game.add_attribute("title", "League of Legends")</span><br><span class="line">=&gt; "League of Legends"</span><br><span class="line"></span><br><span class="line">irb(main):022:0&gt; puts doc2</span><br><span class="line">&lt;collection id='test'&gt;&lt;game title='League of Legends'&gt;&lt;company&gt;&lt;name&gt;Riot Games&lt;/name&gt;&lt;location&gt;America&lt;/location&gt;&lt;/company&gt;&lt;platform&gt;Microsoft Windows&lt;/platform&gt;&lt;/&gt;&lt;pubdate&gt;2011&lt;/pubdate&gt;&lt;/game&gt;&lt;/collection&gt;</span><br><span class="line">=&gt; nil</span><br><span class="line"></span><br><span class="line">irb(main):030:0&gt; doc2.write(:indent =&gt; 2)</span><br><span class="line">&lt;collection id='test'&gt;</span><br><span class="line">  &lt;game title='League of Legends'&gt;</span><br><span class="line">    &lt;company&gt;</span><br><span class="line">      &lt;name&gt;</span><br><span class="line">        Riot Games</span><br><span class="line">      &lt;/name&gt;</span><br><span class="line">      &lt;location&gt;</span><br><span class="line">        America</span><br><span class="line">      &lt;/location&gt;</span><br><span class="line">    &lt;/company&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      Microsoft Windows</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">    &lt;pubdate&gt;</span><br><span class="line">      2011</span><br><span class="line">    &lt;/pubdate&gt;</span><br><span class="line">  &lt;/game&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line">=&gt; [&lt;?xml ... ?&gt;, &lt;collection id='test'&gt; ... &lt;/&gt;]</span><br></pre></td></tr></table></figure>
<p>通过<code>Element.add_attribution</code>可以添加元素属性，第一个参数时key，第二个参数是值；通过<code>Element.new</code>和<code>Element.add_element</code>都可以添加新的元素，但前者需要使用<code>&lt;&lt;</code>方法添加到其父元素下，<code>&lt;&lt;</code>方法是 <code>Elements.add</code>的别名；可以通过<code>Element.text</code>添加或修改元素的文本值； 最后可以通过<code>Document.write</code>输出document</p>
<p>如果想在指定位置插入元素，可以使用<code>Element.insert_before</code> 和<code>Element.insert_after</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">irb(main):031:0&gt; platform2 = Element.new("platform")</span><br><span class="line">=&gt; &lt;platform/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):032:0&gt; platform2.add_text("MacOS X")</span><br><span class="line">=&gt; &lt;platform&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):034:0&gt; doc2.root.insert_before("//pubdate", platform2)</span><br><span class="line">=&gt; &lt;collection id='test'&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;collection id='test'&gt;</span><br><span class="line">  &lt;game title='League of Legends'&gt;</span><br><span class="line">    &lt;company&gt;</span><br><span class="line">      &lt;name&gt;</span><br><span class="line">        Riot Games</span><br><span class="line">      &lt;/name&gt;</span><br><span class="line">      &lt;location&gt;</span><br><span class="line">        America</span><br><span class="line">      &lt;/location&gt;</span><br><span class="line">    &lt;/company&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      Microsoft Windows</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      MacOS X</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">    &lt;pubdate&gt;</span><br><span class="line">      2011</span><br><span class="line">    &lt;/pubdate&gt;</span><br><span class="line">  &lt;/game&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line">=&gt; [&lt;?xml ... ?&gt;, &lt;collection id='test'&gt; ... &lt;/&gt;]</span><br></pre></td></tr></table></figure>
<h5 id="删除元素和属性"><a href="#删除元素和属性" class="headerlink" title="删除元素和属性"></a>删除元素和属性</h5><p>删除元素和属性的方法分别是<code>Element.delete_attribute</code>和<code>Element.delete_element</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">irb(main):040:0&gt; doc2.root.delete_attribute("id")</span><br><span class="line">=&gt; &lt;collection&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):042:0&gt; doc2.write(:indent =&gt; 2)</span><br><span class="line">&lt;collection&gt;</span><br><span class="line">  &lt;game title='League of Legends'&gt;</span><br><span class="line">    &lt;company&gt;</span><br><span class="line">      &lt;name&gt;</span><br><span class="line">        Riot Games</span><br><span class="line">      &lt;/name&gt;</span><br><span class="line">      &lt;location&gt;</span><br><span class="line">        America</span><br><span class="line">      &lt;/location&gt;</span><br><span class="line">    &lt;/company&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      Microsoft Windows</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      MacOS X</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">    &lt;pubdate&gt;</span><br><span class="line">      2011</span><br><span class="line">    &lt;/pubdate&gt;</span><br><span class="line">  &lt;/game&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line">=&gt; [&lt;?xml ... ?&gt;, &lt;collection&gt; ... &lt;/&gt;]</span><br><span class="line"></span><br><span class="line">irb(main):044:0&gt; doc2.delete_element("//pubdate")</span><br><span class="line">=&gt; &lt;pubdate&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):045:0&gt; doc2.write(:indent =&gt; 2)</span><br><span class="line">&lt;collection&gt;</span><br><span class="line">  &lt;game title='League of Legends'&gt;</span><br><span class="line">    &lt;company&gt;</span><br><span class="line">      &lt;name&gt;</span><br><span class="line">        Riot Games</span><br><span class="line">      &lt;/name&gt;</span><br><span class="line">      &lt;location&gt;</span><br><span class="line">        America</span><br><span class="line">      &lt;/location&gt;</span><br><span class="line">    &lt;/company&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      Microsoft Windows</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">    &lt;platform&gt;</span><br><span class="line">      MacOS X</span><br><span class="line">    &lt;/platform&gt;</span><br><span class="line">  &lt;/game&gt;</span><br><span class="line">&lt;/collection&gt;</span><br><span class="line">=&gt; [&lt;?xml ... ?&gt;, &lt;collection&gt; ... &lt;/&gt;]</span><br><span class="line"></span><br><span class="line">irb(main):046:0&gt; doc2.root.delete_element(1)</span><br><span class="line">=&gt; &lt;game title='League of Legends'&gt; ... &lt;/&gt;</span><br><span class="line"></span><br><span class="line">irb(main):047:0&gt; doc2.write(:indent =&gt; 2)</span><br><span class="line">&lt;collection/&gt;</span><br><span class="line">=&gt; [&lt;?xml ... ?&gt;, &lt;collection/&gt;]</span><br><span class="line"></span><br><span class="line">irb(main):048:0&gt; puts doc2</span><br><span class="line">&lt;collection/&gt;</span><br><span class="line">=&gt; nil</span><br></pre></td></tr></table></figure>
<p>通过<code>delete_attribuite</code>来删除属性，参数为属性的<code>key</code>，通过<code>delete_element</code>来删除元素，参数和<code>Elements</code>的<code>[]</code>方法一样，可以是子元素的索引(从1开始)和XPath定位。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/10/02/Ruby中的类定义/" class="prev">PREV</a><a href="/2018/09/16/golang中的Plugin/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 <a href="https://blog.ache.fun">阿扯</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a>.</p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" crossorigin="anonymous"></script><script src="//cdn.bootcss.com/jquery/3.1.1/jquery.js" crossorigin="anonymous"></script><script>$(document).ready(function() { $('pre').each(function(i, block) { hljs.highlightBlock(block); }); });</script></body></html>